PLACES = {
    "Egypt: U01": [
        "syene",
        "elephantine",
        "omboi",
        "|elephantine",
        "philae",
        "isieiu oros",
    ],
    "Egypt: U02": [
        "apollonopolis",
        "apollonopolites",
        "eileithyiopolites|apollonopolites",
    ],
    "Egypt: U03": [
        "eileithyiopolis",
        "latopolites",
        "latopolis",
        "eileithyias polis",
        "hierakonpolis",
        "eileithyiopolis bzw. hermonthis",
    ],
    "Egypt: U04": [
        "theben",
        "diospolis magna (theben)",
        "ta memnoneia (theben)",
        "ta memnoneia",
        "thebes",
        "hermonthis",
        "thynis (theben)",
        "pathyris",
        "pathyrites",
        "hermonthites",
        "memnoneia - djeme (thebes west)",
        "karnak-nord",
        "hermonthis (theben)|ta memnoneia",
        "peri thebas",
        "hermonthis",
        "hermonthis|ta memnoneia theben",
        "memnoneia",
        "der el - medine",
        "herrmonthis",
        "karnak",
        "assassif",
    ],
    "Egypt: U05": ["koptos", "koptites", "myos hormos", "unbekannt bzw. koptos"],
    "Egypt: U06": ["tentyrites", "tentyris", "tentyra", "maximianopolis", "tentyis"],
    "Egypt: U07": [
        "dios polis (hiou)",
        "diopolites",
        "diopolites parvus",
        "diospolis parva",
        "dios polis",
        "nag hamadi",
    ],
    "Egypt: U08": ["thinites", "ptolemais", "this", "ptolemais - akko"],
    "Egypt: U09": [
        "panopolis",
        "panopolites",
        "itos",
        "thmonkeraikis",
        "el - salamuni",
        "hermopolis bzw. panopolis",
    ],
    "Egypt: U10": [
        "antaiopolites",
        "wadi sarga",
        "apollonopolites heptakomias",
        "antaiopolis",
        "apollonopolis heptakomias",
        "aphrodites kome",
        "hepta komai|heptakomia",
        "abotis",
        "antaiopolites bzw. apollonopolites heptakomias",
    ],
    "Egypt: U13": ["lykopolites", "lykopolis", "balaizeh"],
    "Egypt: U15": [
        "hermopolis",
        "hermupolis",
        "hermopolites",
        "antinoopolis",
        "antinoupolis",
        "antinoopolis bzw. hermopolis",
        "antinoites bzw. hermopolites",
        "antinoites",
        "kussites",
        "deyrût",
        "um deirut - nord",
        "prere (hermopolites) bzw. hermopolis",
        "hermopolis bzw. thynis (hermopolites)",
        "beni hassan",
        "amarna",
        "meir",
        "tachomtomu",
        "|antinoopolis|hermonthis",
        "hermopolites bzw. antinoopolis",
        "theodosiopolis",
        "bawit",
        "ibion (antaiopolites)|hermopolites",
    ],
    "Egypt: U17": [
        "kynopolites",
        "kynopolis",
        "pompano",
        "kynon polis",
        "lykopolites|euergetis (kynopolites)",
    ],
    "Egypt: U19": [
        "oxyrhynchos",
        "oxyrhynchus",
        "oxyrhyncha",
        "oxyrhynchites",
        "oxyrynchos",
        "oxyrhynchites|oxyrhyncha (arsinoites)",
        "delta diopolites|memphites|heliopolites|onuphites",
        "saites",
        "metelites",
        "gynaikopolites",
        "|oxyrhynchos",
        "ibion chyseos (oxyrhynchites)|hermopolites",
        "oxyrhynchos|senao",
        "oxyrhynchos|pakerke",
        "suis|oxyrhynchos",
        "terythis",
    ],
    "Egypt: U20": [
        "herakleopolites",
        "herakleopolis",
        "hibeh",
        "nilopolites",
        "herakleopolis|nilopolis",
        "nilopolis",
        "leukogion bzw. onne (herakleopolites)",
        "herakleopolis bzw. tapurseei (herakleopolites)",
        "busiris (herakleopolites)|busirites",
        "hipponon (herakleopolites) bzw. kynopolites",
    ],
    "Egypt: U21": [
        "arsinoites",
        "arsinoiton polis",
        "arsinoitonpolis",
        "gurob",
        "arsinoe",
        "pannonien",
        "krokodilopolis",
        "krokodilopolites",
        "fayūm",
        "nilopolis bzw. soknopaiu nesos (arsinoites)",
        "theodosiopolites",
        "memphites, herakleopolites",
        "tebtynis",
        "nikopolis",
        "kome attinu",
        "ägypten|arsinoites|karanis",
        "unbekannt bzw. memphis",
        "philadelphia",
        "kome th[....]",
        "iuliopolis",
        "krokodilopolis (arsinoites)|pathyrites",
        "unbekannt|unbekannt bzw. ghoran (arsinoites)",
        "herakleia",
    ],
    "Egypt: U22": [
        "aphroditopolites",
        "aphroditopolis",
        "memphis bzw. aphrodites polis",
    ],
    "Egypt: L01": ["memphis", "memphites", "hypsele", "memphites|kerke (arsinoites)"],
    "Egypt: L02": ["letopolites", "letopolis"],
    "Egypt: L03": [
        "alexandria",
        "alexandreon chora",
        "naukratis",
        "kom sciugafa",
        "hermopolis bzw. alexandria",
        "alexandria bzw. panopolis",
        "herakleopolites bzw. kynopolites",
    ],
    "Egypt: L04": ["prosopites"],
    "Egypt: L06": ["kabasites"],
    "Egypt: L07": ["menelaites", "schedia"],
    "Egypt: L08": ["heroopolis"],
    "Egypt: L09": ["busirites"],
    "Egypt: L10": ["athribites", "athribis", "athribites bzw. bubastites"],
    "Egypt: L11": ["leontopolites"],
    "Egypt: L12": ["sebennytes", "unterer sebennytes"],
    "Egypt: L13": ["heliopolites", "heliopolis", "berenikes hormos"],
    "Egypt: L14": [
        "sethroites",
        "pelusion",
        "gerrhon oderskenai ektos gerrhu",
        "antinoopolis bzw. pelusion",
    ],
    "Egypt: L16": ["mendesios", "mendes"],
    "Egypt: L18": ["bubastos", "oxyrhynchos|bubastis"],
    "Egypt: L19": ["pharbaithites"],
    "Egypt: L20": ["arabia", "phakusai", "tuch el - qaramus", "eleira", "rhise"],
    "Egypt: L21": ["tana"],
    "Egypt: Western Desert": [
        "oasis",
        "oasis magna",
        "ain es-sabil",
        "trimithis",
        "kysis",
        "kellis",
        "ammonites",
        "ammoniake",
        "ain waqfa",
        "oasis parva",
        "bir shawish",
        "munesis",
        "deir el-hagar",
        "hibis",
        "mothis",
        "aphrodision",
        "oase el arag",
    ],
    "Egypt: Western Coast": ["abu mena"],
    "Egypt: Eastern Desert": [
        "mons claudianus",
        "wadi hammamat",
        "leukos limen",
        "krokodilo",
        "didymoi",
        "berenike",
        "bernike",
        "mons porphyrites",
        "wâdi fawâkhir",
        "raima",
        "maximianon",
        "abu sha’ar",
        "tiberiane",
        "abbad",
        "kom el - kolzum bei suez",
        "el - heita",
        "xeron pelagos",
        "dios",
        "kasr el banât",
        "kampe",
        "apollonos hydreuma",
        "abû kuway’",
        "qusûr al-banât",
        "umm balad",
        "berenike bzw. koptos",
        "myos hormos bzw. koptos",
        "persu bzw. koptos",
    ],
    "Egypt: Thebais": ["thebais", "untere thebais"],
    "Egypt": ["egypt", "ägypten"],
    "Egypt: Northern Sinai": ["qasr ghet", "rhinokorura"],
    "Egypt: Upper": [
        "oberägypten",
        "delta",
        "arkadia",
        "eunikon",
        "heptanomia",
        "konstantine",
        "abusir",
        "behig",
        "ibion",
        "contrapollonopolis|theben",
    ],
    "Egypt: Middle": ["mittelägypten"],
    "Egypt: Lower": [
        "unterägypten",
        "augustamnica",
        "peptaucha",
        "westlicher teil des nildeltas",
    ],
    "Tunisia": ["gigthis", "carthago"],
    "Turkey": [
        "myra",
        "konstantinopel",
        "aphrodisias",
        "markopolis",
        "side",
        "karien",
        "halikarnass",
        "antiocheia",
        "kyzikos",
        "karrhai",
        "antinoopolis bzw. konstantinopel",
        "bithynien",
    ],
    "Italy": ["rom", "misenum", "puteoli", "neapel, sardeis und hermopolis", "portus"],
    "Israel/Palestina": [
        "askalon",
        "nessana",
        "murabaat",
        "masada",
        "palästina",
        "jericho",
        "gaza",
        "sbeitah",
        "judaea",
        "nahal se’elim",
        "khirbet mird",
        "en - gedi",
        "en gedi",
        "bossia",
        "rabbath moab",
        "birta",
        "khirbet el - kom",
        "aristobulias",
        "nahal mishmar",
        "kaisareia",
        "eleutheropolis",
        "palästina|ptolemais (karien)",
    ],
    "Iran": ["kopanis"],
    "Iraq": ["babylon"],
    "Jordan": ["petra", "maoza", "sadaqa", "augustopolis|petra", "rabbath - moab"],
    "Syria": [
        "dura - europos",
        "beth phuraia",
        "syria coele",
        "syrien",
        "bostra",
        "kleinasien|apamea (syrien)",
        "dura-europos",
    ],
    "Sudan": ["dongola"],
    "Aethiopia": ["pselkis", "primis"],
    "Greece": ["aigai", "rhodos", "kos"],
    "Libya": ["golas", "skithi", "marmarike", "darne in der cyrenaica"],
    "Lebanon": ["beirut"],
    "Crete": ["chersonesos"],
    "Mauretania": ["mauretanien"],
    "": ["unbekannt", "ausland"],
}


def get_nome(x):
    for key, val in PLACES.items():
        if x in val:
            return key
    return ""


def get_split_nome(x):
    parts = x.split("|")
    nomes = [get_nome(y) for y in parts if y != "unbekannt"]
    if all(nomes):
        same_nome = set()
        same_nome.update(nomes)
        if len(same_nome) == 1:
            return nomes[0]
        return "|".join(nomes)

    return ""


def map_to_nome(x):
    for w_f in ["written", "found"]:
        ancient = str(x[f"{w_f}:ancient"]).lower() or ""
        nome = str(x[f"{w_f}:nome"]).lower() or ""
        region = str(x[f"{w_f}:region"]).lower() or ""
        file_name = str(x["file_name"]).lower()

        if file_name in ["stud.pal.3.93.xml"]:
            return "Egypt"

        if nome:
            if key := get_nome(nome):
                if key is not False:
                    return key

            if key := get_split_nome(nome):
                if key == "Egypt: U19|Egypt: U20":
                    if file_name in [
                        "p.count.47.xml",
                        "p.sorb.1.9.xml",
                        "p.sorb.1.12.xml",
                        "p.sorb.1.11.xml",
                        "p.sorb.1.10.xml",
                        "sb.12.11057.xml",
                        "sb.12.11056.xml",
                        "sb.12.11055.xml",
                        "sb.16.12784.xml",
                        "sb.26.16448.xml",
                        "sb.28.17161.xml",
                    ]:
                        return "Egypt: U19"
                    elif file_name in [
                        "p.frankf.6.xml",
                        "p.frankf.5.xml",
                        "p.koeln.13.534.xml",
                        "p.oslo.2.61.xml",
                        "p.oxy.38.2842.xml",
                        "stud.pal.8.1346.xml",
                    ]:
                        return "Egypt: U20"
                    return key

                elif key == "Egypt: U21|Egypt: U20":
                    if file_name in ["basp.53.46_4.xml"]:
                        return "Egypt: U20"
                    else:
                        return "Egypt: U21"

                elif key == "Egypt: U19|Egypt: U15":
                    if file_name in [
                        "p.gen.2.95.xml",
                        "p.ifao.1.18.xml",
                        "p.leid.inst.69.xml",
                    ]:
                        return "Egypt: U15"
                    elif file_name in ["psi.16.1634.xml"]:
                        return "Egypt: U19"
                    return key

                elif key == "Egypt: U19|Egypt: U21":
                    if file_name in ["sb.12.11236.xml", "sb.12.11235.xml"]:
                        return "Egypt: U20"
                    elif file_name in [
                        "sb.18.13919.xml",
                        "sb.18.13918.xml",
                        "sb.18.13917.xml",
                        "sb.18.13157.xml",
                        "sb.22.15203.xml",
                    ]:
                        return "Egypt: U21"
                    elif file_name in ["sb.22.15204.xml"]:
                        return ""
                    return key

                elif key == "Egypt: U15|Egypt: U20":
                    if file_name in ["cpr.19.25.xml", "t.varie.3.xml"]:
                        return "Egypt: U15"
                    elif file_name in [
                        "cpr.8.51.xml",
                        "p.bodl.1.61g.xml",
                        "stud.pal.3.402.xml",
                        "stud.pal.3.331.xml",
                    ]:
                        return "Egypt: U20"

                elif key == "Egypt: U15|Egypt: U21":
                    if file_name in [
                        "p.eirene.2.24.xml",
                        "p.lond.5.1738.xml",
                        "tyche.28.128.xml",
                    ]:
                        return "Egypt: U15"
                    elif file_name in [
                        "sb.18.13595.xml",
                        "sb.18.13161.xml",
                        "stud.pal.3.155.xml",
                    ]:
                        return "Egypt: U21"

                elif "|" in key:
                    if file_name in ["p.oxy.38.2853r.xml"]:
                        return "Egypt: U08"

                    elif file_name in ["sb.22.15525.xml", "sb.22.15523.xml"]:
                        return "Egypt: U10"

                    elif file_name in ["stud.pal.22.156.xml"]:
                        return "Egypt: L04"

                    elif file_name in ["sb.20.14416.xml"]:
                        return "Egypt: U15"

                    elif file_name in ["p.princ.2.19.xml"]:
                        return "Egypt: U17"

                    elif file_name in ["p.harr.1.87.xml", "p.oxy.38.2853v.xml"]:
                        return "Egypt: U19"

                    elif file_name in [
                        "bgu.2.408.xml",
                        "p.heid.7.393.xml",
                        "p.mich.1.12.xml",
                        "p.prag.1.27.xml",
                        "p.worp.34.xml",
                        "p.worp.33.xml",
                        "stud.pal.3(2).2.166.xml",
                    ]:
                        return "Egypt: U21"

                    elif file_name in ["p.hib.2.205.xml", "p.oxy.31.2581.xml"]:
                        return "Egypt: L01"

                    elif file_name in ["p.lond.5.1842.xml", "p.oxy.3.488.xml"]:
                        return "Egypt: U10"

                    elif file_name in ["jjp.50.115_1.xml"]:
                        return "Egypt: Upper"

                    # print(file_name)

                if key is not False:
                    return key

            if "|" not in nome and "theben" in nome:
                return "U04"

            # print(f'Uknown nome: {nome}')
            # print(str(x['file_name']).lower())
        else:
            if ancient:
                if key := get_nome(ancient):
                    if key is not False:
                        return key

                if key := get_split_nome(ancient):
                    if key == "Egypt: U19|Egypt: U15":
                        if file_name in [
                            "p.bingen.128.xml",
                            "p.hamb.4.264.xml",
                            "p.lond.5.1791.xml",
                            "p.mert.1.12.xml",
                            "p.michael.23.xml",
                        ]:
                            return "Egypt: U19"
                        elif file_name in ["p.oxy.6.970.xml", "p.oxy.79.5206.xml"]:
                            return "Egypt: U15"

                    elif key == "Egypt: U01|Egypt: U04":
                        if file_name in ["o.wilck.283.xml", "o.wilck.16.xml"]:
                            return "Egypt: U01"
                        elif file_name in [
                            "o.wilck.1218.xml",
                            "o.wilck.1051.xml",
                            "sb.10.10511.xml",
                            "sb.10.10510.xml",
                            "sb.10.10509.xml",
                        ]:
                            return "Egypt: U04"

                    elif key == "Egypt: U05|Egypt: U04":
                        if file_name in [
                            "o.bodl.2.1027.xml",
                            "o.bodl.2.1026.xml",
                            "o.bodl.2.1025.xml",
                            "o.bodl.2.1024.xml",
                        ]:
                            return "Egypt: U05"
                        elif file_name in ["o.deiss.34.xml", "zpe.156.168.xml"]:
                            return "Egypt: U04"

                    elif key == "Egypt: U02|Egypt: U04":
                        return "Egypt: U04"

                    elif "|" in key:
                        if file_name in ["bgu.6.1216.xml"]:
                            return "Egypt: U01"

                        if file_name in ["p.ross.georg.2.30.xml"]:
                            return "Egypt: L01"

                        elif file_name in [
                            "p.bub.1.4.xml",
                            "p.oxy.4.706.xml",
                            "sb.14.11978.xml",
                            "sb.4.7333.xml",
                        ]:
                            return "Egypt: L03"

                        elif file_name in ["o.heid.161.xml", "p.jena.2.4.xml"]:
                            return "Egypt: U03"

                        elif file_name in ["o.bodl.1.317.xml"]:
                            return "Egypt: U04"

                        elif file_name in ["p.cair.masp.3.67298.xml"]:
                            return "Egypt: U06"

                        elif file_name in ["p.grenf.2.82.xml"]:
                            return "Egypt: U09"

                        elif file_name in [
                            "p.cair.masp.1.67009.xml",
                            "sb.20.14173.xml",
                        ]:
                            return "Egypt: U15"

                        elif file_name in [
                            "o.oasis.appendice.xml",
                            "p.sijp.10c.xml",
                            "sb.26.16571.xml",
                        ]:
                            return "Egypt: U19"

                        elif file_name in ["p.louvre.2.127.xml", "stud.pal.3.418.xml"]:
                            return "Egypt: U21"

                        elif file_name in ["c.jud.syr.eg.8.xml"]:
                            return "Egypt: Lower"

                        elif file_name in ["rom.mil.rec.1.78_69.xml"]:
                            return "Aethiopia"

                        elif file_name in ["p.bour.19.xml"]:
                            return "Egypt: Upper"

                        elif file_name in [
                            "p.cair.zen.1.59010.xml",
                            "p.hever.73.xml",
                            "p.hever.72.xml",
                            "p.hever.71.xml",
                            "p.hever.70.xml",
                        ]:
                            return "Israel/Palestina"

                        elif file_name in ["p.hoogendijk.52.xml"]:
                            return "Egypt"

                    if key is not False:
                        return key

                if "|" not in ancient and "theben" in ancient:
                    return "Egypt: U04"

                if "|" not in ancient and "arsinoi" in ancient:
                    return "Egypt: U21"

                if "|" not in ancient and "oxy" in ancient:
                    return "Egypt: U19"

                if ancient == "unbekannt":
                    if region == "oberägypten":
                        return "Egypt: Upper"
                    if region == "ägypten":
                        return "Egypt"
                    return ""

                if region in ["oasis parva", "oasis magna"]:
                    return "Egypt: Western Desert"

                if region in ["italien"]:
                    return "Italy"

                if region in ["marmarike"]:
                    return "Libya"

                if region in ["oberägypten", "delta"]:
                    return "Egypt: Upper"

                if region in ["oxyrhynchos"]:
                    return "Egypt: U19"

                if region in ["palästina"]:
                    return "Israel/Palestina"

                if region in ["thebais"]:
                    return "Egypt: Thebais"

                if region in ["nicht ägypten"]:
                    return ""

                if region in ["frauenkloster hathor"]:
                    return "Egypt: U20"

                if region in [
                    "in der nähe von dura - europos",
                    "iardas in der nähe von dura - europos",
                    "syria coele",
                ]:
                    return "Syria"

                print(f"Uknown ancient: {ancient}")
                print(str(x["file_name"]).lower())
                print(f"Region: {region}")

    return ""


def convert_place(hgv_meta, file_name):
    x = {
        "file_name": file_name,
        "found:ancient": "|".join(hgv_meta["found"]["ancient"]),
        "found:nome": "|".join(hgv_meta["found"]["nome"]),
        "found:region": "|".join(hgv_meta["found"]["region"]),
        "written:ancient": "|".join(hgv_meta["written"]["ancient"]),
        "written:nome": "|".join(hgv_meta["written"]["nome"]),
        "written:region": "|".join(hgv_meta["written"]["region"]),
    }
    return map_to_nome(x)
